[tox]
envlist = python310

[testenv]
usedevelop = true
extras = dev
allowlist_externals = sh
commands =
    pytest
    ruff format --check --line-length 120 .
    ruff check .
    mypy --strict --ignore-missing-imports .
    bandit -c pyproject.toml -r -q .

[testenv:security]
# CVE scanning environment - builds and scans the local package
usedevelop = true
extras = dev
deps =
    pip-audit
allowlist_externals = sh, mkdir
commands =
    mkdir -p security-reports

    sh -c "pip list"

    # Run CVE scan on installed dependencies
    sh -c "pip-audit --desc --format=json --output=security-reports/pip-audit.json || pip-audit --desc"

    # Display summary
    sh -c "echo '=== CVE Scan Summary ==='"
    sh -c "echo 'Tool: pip-audit (Apache 2.0 licensed)'"
    sh -c "echo 'Report: security-reports/pip-audit.json'"
